<html>
<head>
	<link rel="stylesheet" type="text/css" href="css/jquery-comments.css">
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery-comments.js"></script>
</head>
<body>

<div id="comments-container"></div>
<script src="https://www.gstatic.com/firebasejs/4.3.1/firebase.js"></script>
<script>
  // Initialize Firebase
  // TODO: Replace with your project's customized code snippet
  var config = {
    apiKey: "AIzaSyCSLUyTrce4YAZweq0NGTX71UdVhzPLxQ0",
    authDomain: "swilter-4f741.firebaseapp.com",
    databaseURL: "https://swilter-4f741.firebaseio.com"
  };
  firebase.initializeApp(config);
</script>
<script>
// function printComments() {
// 	console.log(commentsArray);
// }
// Get a reference to the database service
var database = firebase.database();
function writeUserData(commentJSON) {
	var n = 0;
	database.ref().on("value", function(data) {
		n = data.numChildren();
	});
	//var keyi = String(commentJSON[n]);
	var payload = {};
	payload[n] = commentJSON;
	firebase.database().ref().update(
		payload
	);
}

function readAllData() {
	var commentsArray = [];
    database.ref().on("value", function(data) {
		console.log(data);
		data.forEach(function(childSnapshot) {
	      console.log(childSnapshot.val());
	      commentsArray.push(childSnapshot.val());
	    });

        console.log(commentsArray);
        return commentsArray;
	});
}
$('#comments-container').comments({
    profilePictureURL: 'https://app.viima.com/static/media/user_profiles/user-icon.png',
    postComment: function(commentJSON, success, error) {
    	console.log(commentJSON);
    	//console.log(database.ref().getChildren());
    	database.ref().on("value", function(data) {
    		console.log(data);
    		data.forEach(function(childSnapshot) {
		      console.log(childSnapshot.val());
		    });
    	});
    	writeUserData(commentJSON);
    	success(commentJSON);
    	
    	// $.ajax({
     //        type: 'get',
     //        url: 'https://swilter-4f741.firebaseio.com',
     //        crossDomain: true,
     //        success: function(data) {
     //            console.log(data);
     //        },
     //        error: error
     //    });
        // $.ajax({
        //     type: 'post',
        //     url: '/api/comments/',
        //     data: commentJSON,
        //     success: function(comment) {
        //         success(comment)
        //     },
        //     error: error
        // });
    },
    getComments: function(success, error) {
        // var commentsArray = [{
        //     id: 1,
        //     created: '2015-10-01',
        //     content: 'Lorem ipsum dolort sit amet',
        //     fullname: 'Simon Powell',
        //     upvote_count: 2,
        //     user_has_upvoted: false
        // }];
        var commentsArray = [];
        database.ref().on("value", function(data) {
    		console.log(data);
    		data.forEach(function(childSnapshot) {
		      console.log(childSnapshot.val());
		      commentsArray.push(childSnapshot.val());
		    });

	        console.log(commentsArray);
	        success(commentsArray);
    	});
    }
});

// setInterval(printComments(), 60000);
</script>
</body>
</html>